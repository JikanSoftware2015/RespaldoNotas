<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Respaldar Notas a blocdenotas_backup.db</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f5f5f5; max-width: 800px; margin: auto; }
    input, textarea { width: 100%; padding: 14px; margin: 8px 0 18px; font-size: 18px; border-radius: 6px; border: 1px solid #ccc; }
    button { display: block; width: 100%; margin: 12px 0; padding: 14px; font-size: 18px; border: none; background: #0066cc; color: #fff; border-radius: 8px; cursor: pointer; }
    button:hover { background: #004999; }
    .nota { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; background: #fff; border-radius: 10px; }
    h2 { font-size: 26px; margin-bottom: 20px; }
    h3 { font-size: 22px; margin: 0 0 15px 0; }
    p { font-size: 18px; margin-bottom: 20px; }
  </style>
</head>
<body>

<h2>Generar respaldo blocdenotas_backup.db</h2>
<p>Completa tus notas aquÃ­. Puedes agregar hasta 500 notas.</p>

<div id="contenedorNotas"></div>

<button onclick="agregarNota()">+ Agregar otra nota</button>
<button onclick="generarRespaldo()">ðŸ“¥ Descargar respaldo_blocdenotas.db</button>

<script src="https://sql.js.org/dist/sql-wasm.js"></script>
<script>
let contadorNotas = 0;
const LIMITE_NOTAS = 500;

function agregarNota() {
  if (contadorNotas >= LIMITE_NOTAS) {
    alert("Has alcanzado el lÃ­mite de 500 notas.");
    return;
  }

  contadorNotas++;
  const div = document.createElement('div');
  div.className = 'nota';
  div.innerHTML = `
    <h3>Nota ${contadorNotas}</h3>
    <input type="text" placeholder="TÃ­tulo de la nota" id="titulo${contadorNotas}">
    <textarea placeholder="Contenido de la nota" rows="4" id="contenido${contadorNotas}"></textarea>
  `;
  document.getElementById('contenedorNotas').appendChild(div);
}

async function generarRespaldo() {
  const SQL = await initSqlJs({ locateFile: file => `https://sql.js.org/dist/${file}` });
  const db = new SQL.Database();
  db.run("CREATE TABLE notes (title TEXT, body TEXT, updated_at INTEGER);");

  const now = Date.now();
  let notasInsertadas = 0;

  for (let i = 1; i <= contadorNotas; i++) {
    const tituloInput = document.getElementById(`titulo${i}`);
    const contenidoInput = document.getElementById(`contenido${i}`);

    if (!contenidoInput || !contenidoInput.value.trim()) continue;

    let titulo = "Sin tÃ­tulo";
    if (tituloInput && tituloInput.value.trim()) {
      titulo = tituloInput.value.trim();
    }

    const contenido = contenidoInput.value.trim();

    db.run("INSERT INTO notes (title, body, updated_at) VALUES (?, ?, ?);", [titulo, contenido, now + i]);
    notasInsertadas++;
  }

  if (notasInsertadas === 0) {
    alert("Debes ingresar al menos una nota con contenido.");
    return;
  }

  const binaryArray = db.export();
  const blob = new Blob([binaryArray], { type: 'application/octet-stream' });
  const enlace = document.createElement('a');
  enlace.href = URL.createObjectURL(blob);
  enlace.download = 'respaldo_blocdenotas.db';
  enlace.click();
}

agregarNota();
</script>

</body>
</html>
