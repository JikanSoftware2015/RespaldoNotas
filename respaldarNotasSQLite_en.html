<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notes Recovery and Backup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; line-height: 1.6; background: #f5f5f5; color: #333; margin: 20px; }
    h1, h2, h3 { text-align: center; }
    .section { background: #fff; padding: 20px; margin: 20px auto; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); max-width: 900px; }
    p, li { font-size: 18px; }
    .btn { display: inline-block; padding: 12px 20px; margin: 15px 0; background: #007BFF; color: #fff; border-radius: 8px; text-decoration: none; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    #video-container { display: none; margin-top: 20px; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; }
    #video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 12px; }
    input, textarea { width: 100%; padding: 14px; margin: 8px 0 18px; font-size: 18px; border-radius: 6px; border: 1px solid #ccc; }
    button { display: block; width: 100%; margin: 12px 0; padding: 14px; font-size: 18px; border: none; background: #0066cc; color: #fff; border-radius: 8px; cursor: pointer; }
    button:hover { background: #004999; }
    .nota { border: 1px solid #ddd; padding: 20px; margin-bottom: 20px; background: #fff; border-radius: 10px; }

    @media (max-width: 600px) {
      body { margin: 10px; }
      p, li { font-size: 16px; }
      input, textarea, button { font-size: 16px; padding: 12px; }
      h1 { font-size: 24px; }
      h2 { font-size: 20px; }
      h3 { font-size: 18px; }
    }
  </style>
</head>
<body>

  <p style="text-align:center; margin-bottom:20px;">
    <a href="index.html" class="btn">Ver versi√≥n en Espa√±ol</a>
  </p>

  <h1>Notes Recovery</h1>

  <div class="section">
    <h2>Explanation</h2>
    <p>I want to clarify something fundamental: Your notes were not stolen or hacked. No one has access to them, as they have always been stored only on your mobile device or in your Google Drive account if you used it. That said, we unfortunately suffered a theft and betrayal by a former friend and former employee, which directly affected the development and maintenance of this application. The application is reliable, and those of you who have used it know this happened due to errors made by a person, not the application. I hope you can understand and that we can all move forward together.</p>
  </div>

  <div class="section">
    <h2>Instructions ‚Äì Part One</h2>
    <p>This process has two parts, and this is the first one. After finishing this step, you should still have your notes in the old version.</p>
    <p>Neither I nor anyone else has access to your notes. Your notes are always on your mobile device or in your Google Drive. You cannot uninstall the app until you have already saved your notes. If you uninstalled it before, this process will not work anymore.</p>

    <h3>Steps:</h3>
    <ol>
      <li>Go to the testing link.</li>
      <li>Click on ‚ÄúBecome a tester‚Äù.</li>
      <li>Click on the first download link you see.</li>
      <li>Click on update. It must say ‚ÄúUpdate‚Äù; if not, something went wrong.</li>
    </ol>

    <p><a href="https://play.google.com/apps/testing/jikansoftware.com.blocdenotas" class="btn" target="_blank">Go to testing link</a></p>

    <button class="btn" onclick="document.getElementById('video-container').style.display='block'">Watch Tutorial Video</button>
    <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:12px;">
      <iframe src="https://www.youtube.com/embed/ZwUyATVof90" 
              frameborder="0" 
              allowfullscreen 
              style="position:absolute;top:0;left:0;width:100%;height:100%;">
      </iframe>
    </div>
  </div>

  <div class="section">
    <h2>Part Two</h2>
    <p>After recovering your notes, please make a backup to avoid possible issues. You must use the form I created for that.</p>
    <p>Once you‚Äôve saved your notes, go to the Play Store and leave the tester program to install the new version, since this one is only temporary. Remember: do this only after you have made a backup.</p>
    <p>The most recommended option is to use the backup form. It may be a bit tedious, but it‚Äôs the safest option. This old version is temporary, and the deadline is until the end of September. I‚Äôll be checking messages and will reply within 1‚Äì2 days maximum.</p>
    <p>I‚Äôm very happy for the users who have already recovered their notes üôè Blessings. And please don‚Äôt forget to give me a good rating both on the test version and on the new version, thank you!</p>
  </div>

  <div class="section">
    <h2>Generate backup blocdenotas_backup.db</h2>
    <p style="text-align:center; font-size:16px; color:#555; margin-bottom:20px;">
      üíæ Your notes are being saved locally in your browser until you download the file.<br>
      ‚ö†Ô∏è If you clear your browser cache, they will be deleted.<br>
      ‚úÖ You can leave and return, and continue where you left off without losing progress.
    </p>

    <div id="contenedorNotas"></div>

    <button onclick="agregarNota()">+ Add another note</button>
    <button onclick="generarRespaldo()">üì• Download respaldo_blocdenotas.db</button>

    <p style="text-align:center; font-size:18px; margin-top:30px;">
      üì¢ <strong>Important:</strong> If in your current version of the app you couldn‚Äôt back up your notes, it is essential that you use this form as soon as possible to save them into a file.
      <br><br>
      Once the backup is downloaded to your phone üì±, you can update to the new version of the app from our special link.
      <br><br>
      üëâ <a href="https://play.google.com/apps/testing/jikansoftware.com.blocdenotas" target="_blank" style="font-weight:bold;">Update to the new version on Google Play</a>
      <br><br>
      üìå Please do this before updating, so you don‚Äôt lose any important notes.
    </p>
  </div>

<script src="https://sql.js.org/dist/sql-wasm.js"></script>
<script>
let contadorNotas = 0;
const LIMITE_NOTAS = 500;

function saveToLocalStorage() {
  const notas = [];
  for (let i = 1; i <= contadorNotas; i++) {
    const titulo = document.getElementById(`titulo${i}`)?.value || "";
    const contenido = document.getElementById(`contenido${i}`)?.value || "";
    if (titulo || contenido) {
      notas.push({ titulo, contenido });
    }
  }
  localStorage.setItem("notasBackup", JSON.stringify(notas));
}

function loadFromLocalStorage() {
  const notasGuardadas = JSON.parse(localStorage.getItem("notasBackup") || "[]");
  notasGuardadas.forEach(n => {
    agregarNota(n.titulo, n.contenido);
  });
}

function agregarNota(titulo = "", contenido = "") {
  if (contadorNotas >= LIMITE_NOTAS) {
    alert("You have reached the 500 notes limit.");
    return;
  }

  contadorNotas++;
  const div = document.createElement('div');
  div.className = 'nota';
  div.innerHTML = `
    <h3>Note ${contadorNotas}</h3>
    <input type="text" placeholder="Note title" id="titulo${contadorNotas}" value="${titulo}">
    <textarea placeholder="Note content" rows="4" id="contenido${contadorNotas}">${contenido}</textarea>
  `;
  document.getElementById('contenedorNotas').appendChild(div);

  div.querySelectorAll("input, textarea").forEach(el => {
    el.addEventListener("input", saveToLocalStorage);
  });
}

async function generarRespaldo() {
  const SQL = await initSqlJs({ locateFile: file => `https://sql.js.org/dist/${file}` });
  const db = new SQL.Database();
  db.run("CREATE TABLE notes (title TEXT, body TEXT, updated_at INTEGER);");

  const now = Date.now();
  let inserted = 0;

  for (let i = 1; i <= contadorNotas; i++) {
    const tituloInput = document.getElementById(`titulo${i}`);
    const contenidoInput = document.getElementById(`contenido${i}`);

    if (!contenidoInput || !contenidoInput.value.trim()) continue;

    let titulo = "Untitled";
    if (tituloInput && tituloInput.value.trim()) {
      titulo = tituloInput.value.trim();
    }

    const contenido = contenidoInput.value.trim();

    db.run("INSERT INTO notes (title, body, updated_at) VALUES (?, ?, ?);", [titulo, contenido, now + i]);
    inserted++;
  }

  if (inserted === 0) {
    alert("You must enter at least one note with content.");
    return;
  }

  const binaryArray = db.export();
  const blob = new Blob([binaryArray], { type: 'application/octet-stream' });
  const enlace = document.createElement('a');
  enlace.href = URL.createObjectURL(blob);
  enlace.download = 'respaldo_blocdenotas.db';
  enlace.click();

  // Clear saved notes and refresh page
  localStorage.removeItem("notasBackup");
  setTimeout(() => location.reload(), 800);
}

loadFromLocalStorage();
if (contadorNotas === 0) agregarNota();
</script>

</body>
</html>
